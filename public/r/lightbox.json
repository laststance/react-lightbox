{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "lightbox",
  "type": "registry:component",
  "title": "Lightbox",
  "description": "A responsive lightbox component with image gallery, keyboard navigation, and accessibility support.",
  "dependencies": [
    "lucide-react"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/lightbox/lightbox.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { ChevronLeft, ChevronRight, X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\n/**\n * Image object used in the Lightbox component\n */\nexport interface LightboxImage {\n  src: string\n  alt?: string\n  caption?: string\n}\n\n/**\n * Lightbox component props\n */\nexport interface LightboxProps extends React.HTMLAttributes<HTMLDivElement> {\n  images: LightboxImage[]\n  loop?: boolean\n}\n\n/**\n * A Lightbox component that displays images in a modal with navigation controls\n */\nexport function Lightbox({\n  images,\n  loop = false,\n  className,\n  ...props\n}: LightboxProps) {\n  const [isOpen, setIsOpen] = React.useState<boolean>(false)\n  const [currentIndex, setCurrentIndex] = React.useState<number>(0)\n  const [isLoading, setIsLoading] = React.useState<boolean>(true)\n  const [preloadedIndexes, setPreloadedIndexes] = React.useState<Set<number>>(\n    new Set()\n  )\n\n  const lightboxRef = React.useRef<HTMLDivElement>(null)\n  const thumbnailRefs = React.useRef<(HTMLImageElement | null)[]>([])\n\n  // Preload current image and adjacent images\n  const preloadImages = React.useCallback(\n    (index: number) => {\n      if (preloadedIndexes.has(index)) return\n\n      const imagesToPreload = [index]\n\n      // Add previous image to preload list\n      if (index > 0 || loop) {\n        const prevIndex = index > 0 ? index - 1 : images.length - 1\n        imagesToPreload.push(prevIndex)\n      }\n\n      // Add next image to preload list\n      if (index < images.length - 1 || loop) {\n        const nextIndex = index < images.length - 1 ? index + 1 : 0\n        imagesToPreload.push(nextIndex)\n      }\n\n      // Preload images\n      imagesToPreload.forEach((idx) => {\n        if (!preloadedIndexes.has(idx)) {\n          const img = new Image()\n          img.src = images[idx].src\n          img.onload = () => {\n            setPreloadedIndexes((prev) => new Set([...prev, idx]))\n          }\n        }\n      })\n    },\n    [images, loop, preloadedIndexes]\n  )\n\n  // Open lightbox\n  const openLightbox = React.useCallback(\n    (index: number) => {\n      setCurrentIndex(index)\n      setIsOpen(true)\n      setIsLoading(true)\n      document.body.style.overflow = \"hidden\"\n      preloadImages(index)\n    },\n    [preloadImages]\n  )\n\n  // Close lightbox\n  const closeLightbox = React.useCallback(() => {\n    setIsOpen(false)\n    document.body.style.overflow = \"auto\"\n  }, [])\n\n  // Navigate to previous image\n  const prevImage = React.useCallback(() => {\n    setIsLoading(true)\n    if (currentIndex === 0 && !loop) {\n      setIsLoading(false)\n    } else if (currentIndex > 0) {\n      setCurrentIndex(currentIndex - 1)\n      preloadImages(currentIndex - 1)\n    } else if (loop) {\n      setCurrentIndex(images.length - 1)\n      preloadImages(images.length - 1)\n    }\n  }, [currentIndex, images.length, loop, preloadImages])\n\n  // Navigate to next image\n  const nextImage = React.useCallback(() => {\n    setIsLoading(true)\n    if (currentIndex === images.length - 1 && !loop) {\n      setIsLoading(false)\n    } else if (currentIndex < images.length - 1) {\n      setCurrentIndex(currentIndex + 1)\n      preloadImages(currentIndex + 1)\n    } else if (loop) {\n      setCurrentIndex(0)\n      preloadImages(0)\n    }\n  }, [currentIndex, images.length, loop, preloadImages])\n\n  // Keyboard navigation\n  React.useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isOpen) return\n\n      switch (e.key) {\n        case \"ArrowLeft\":\n          prevImage()\n          break\n        case \"ArrowRight\":\n          nextImage()\n          break\n        case \"Escape\":\n          closeLightbox()\n          break\n        default:\n          break\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [isOpen, prevImage, nextImage, closeLightbox])\n\n  // Focus trap for accessibility\n  React.useEffect(() => {\n    if (!isOpen || !lightboxRef.current) return\n\n    const lightbox = lightboxRef.current\n    const focusableElements = lightbox.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    )\n\n    const firstElement = focusableElements[0] as HTMLElement\n    const lastElement = focusableElements[\n      focusableElements.length - 1\n    ] as HTMLElement\n\n    const handleTabKey = (e: KeyboardEvent) => {\n      if (e.key !== \"Tab\") return\n\n      if (e.shiftKey) {\n        if (document.activeElement === firstElement) {\n          lastElement.focus()\n          e.preventDefault()\n        }\n      } else {\n        if (document.activeElement === lastElement) {\n          firstElement.focus()\n          e.preventDefault()\n        }\n      }\n    }\n\n    lightbox.addEventListener(\"keydown\", handleTabKey)\n    firstElement?.focus()\n\n    return () => {\n      lightbox.removeEventListener(\"keydown\", handleTabKey)\n    }\n  }, [isOpen])\n\n  // Handle image load completion\n  const handleImageLoad = () => {\n    setIsLoading(false)\n  }\n\n  return (\n    <>\n      {/* Thumbnails */}\n      <div className={cn(\"grid grid-cols-1 gap-4\", className)} {...props}>\n        {images.map((image, index) => (\n          <div\n            key={index}\n            className=\"cursor-pointer overflow-hidden rounded-lg\"\n            onClick={() => openLightbox(index)}\n          >\n            <img\n              ref={(el) => {\n                thumbnailRefs.current[index] = el\n              }}\n              src={image.src || \"/placeholder.svg\"}\n              alt={image.alt}\n              className=\"h-48 w-full object-cover transition-transform duration-300 hover:scale-110\"\n            />\n          </div>\n        ))}\n      </div>\n\n      {/* Lightbox Modal */}\n      {isOpen && (\n        <div\n          ref={lightboxRef}\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/90\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) closeLightbox()\n          }}\n          aria-modal=\"true\"\n          role=\"dialog\"\n        >\n          {/* Close Button */}\n          <button\n            className=\"absolute right-4 top-4 z-10 rounded-full bg-black/50 p-2 text-white transition-opacity hover:bg-black/70\"\n            onClick={closeLightbox}\n            aria-label=\"Close lightbox\"\n          >\n            <X className=\"h-6 w-6\" />\n          </button>\n\n          {/* Previous Button */}\n          {(currentIndex > 0 || loop) && (\n            <button\n              className=\"absolute left-4 top-1/2 -translate-y-1/2 rounded-full bg-black/50 p-2 text-white transition-opacity hover:bg-black/70\"\n              onClick={prevImage}\n              aria-label=\"Previous image\"\n            >\n              <ChevronLeft className=\"h-8 w-8\" />\n            </button>\n          )}\n\n          {/* Next Button */}\n          {(currentIndex < images.length - 1 || loop) && (\n            <button\n              className=\"absolute right-4 top-1/2 -translate-y-1/2 rounded-full bg-black/50 p-2 text-white transition-opacity hover:bg-black/70\"\n              onClick={nextImage}\n              aria-label=\"Next image\"\n            >\n              <ChevronRight className=\"h-8 w-8\" />\n            </button>\n          )}\n\n          {/* Image Container */}\n          <div className=\"relative flex max-h-[90vh] max-w-[90vw] flex-col items-center\">\n            {/* Loading Spinner */}\n            {isLoading && (\n              <div\n                className=\"absolute inset-0 flex items-center justify-center\"\n                data-testid=\"lightbox-loading-spinner\"\n              >\n                <div className=\"h-12 w-12 animate-spin rounded-full border-4 border-white border-t-transparent\"></div>\n              </div>\n            )}\n\n            {/* Current Image */}\n            <img\n              src={images[currentIndex].src || \"/placeholder.svg\"}\n              alt={images[currentIndex].alt}\n              className={cn(\n                \"max-h-[80vh] max-w-full object-contain transition-opacity duration-300\",\n                isLoading ? \"opacity-0\" : \"opacity-100\"\n              )}\n              onLoad={handleImageLoad}\n            />\n\n            {/* Caption */}\n            {images[currentIndex].caption && (\n              <div className=\"mt-4 max-w-full px-4 text-center text-white\">\n                <p className=\"text-lg\">{images[currentIndex].caption}</p>\n              </div>\n            )}\n\n            {/* Counter */}\n            <div className=\"absolute bottom-4 left-4 rounded-full bg-black/50 px-3 py-1 text-sm text-white\">\n              {currentIndex + 1} / {images.length}\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n",
      "type": "registry:component"
    }
  ]
}